<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <title>Koref Crawler Dashboard</title>
  <style>
    body{font-family:Arial,Helvetica,sans-serif;text-align:center;padding:40px}
    .progress-bar{width:60%;margin:20px auto;background:#eee;border-radius:12px;height:28px;overflow:hidden;display:none}
    .progress{height:100%;background:#4caf50;width:0;transition:width .5s}
    button{padding:10px 18px;font-size:16px;margin:6px}
  </style>
</head>
<body>
  <h1>Koref Crawler</h1>
  <p>Start 버튼을 누르면 GitHub Actions에서 크롤러를 실행할 수 있습니다.</p>

  <button id="start">Start (Open workflow run page)</button>
  <div class="progress-bar" id="bar"><div class="progress" id="barInner"></div></div>
  <p id="status">대기 중</p>
  <button id="view" style="display:none" onclick="location.href='result.html'">확인</button>

  <script>
    const startBtn = document.getElementById('start');
    const bar = document.getElementById('bar');
    const barInner = document.getElementById('barInner');
    const status = document.getElementById('status');
    const viewBtn = document.getElementById('view');

    // Replace with your repo owner/name and workflow file name
    const OWNER = 'YOUR_GITHUB_USERNAME_OR_ORG';
    const REPO = 'YOUR_REPOSITORY_NAME';
    const WORKFLOW_FILENAME = 'crawl.yml'; // workflow file under .github/workflows

    startBtn.addEventListener('click', () => {
      // We cannot safely trigger workflow from client without token.
      // So open the GitHub Actions workflow run UI so user can press "Run workflow".
      const url = `https://github.com/${OWNER}/${REPO}/actions/workflows/${WORKFLOW_FILENAME}`;
      window.open(url, '_blank');
      // Show polling UI anyway (in case user runs manually)
      bar.style.display = 'block';
      poll();
    });

    async function poll() {
      try {
        const res = await fetch('status.json?_=' + Date.now());
        if (!res.ok) throw 'no status';
        const st = await res.json();
        barInner.style.width = st.progress + '%';
        status.textContent = st.done ? '✅ 수집 완료' : `진행 중: ${st.current_board || ''} ${st.progress}%`;
        if (st.done) {
          viewBtn.style.display = 'inline-block';
        } else {
          setTimeout(poll, 2000);
        }
      } catch (e) {
        // no status.json yet
        status.textContent = '상태 대기 중... (Actions 실행 후 자동 갱신)';
        setTimeout(poll, 4000);
      }
    }

    // initial poll
    poll();
  </script>
</body>
</html>
