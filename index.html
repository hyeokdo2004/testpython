<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <title>Koref Crawler Dashboard</title>
  <style>
    body {
      font-family: Arial, Helvetica, sans-serif;
      text-align: center;
      padding: 40px;
    }
    .progress-bar {
      width: 60%;
      margin: 20px auto;
      background: #eee;
      border-radius: 12px;
      height: 28px;
      overflow: hidden;
      display: none;
    }
    .progress {
      height: 100%;
      background: #4caf50;
      width: 0;
      transition: width .5s;
    }
    button {
      padding: 10px 18px;
      font-size: 16px;
      margin: 6px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>Koref Crawler</h1>
  <p>Start ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ GitHub Actionsì—ì„œ í¬ë¡¤ëŸ¬ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

  <button id="start">Start (Open workflow run page)</button>
  <div class="progress-bar" id="bar"><div class="progress" id="barInner"></div></div>
  <p id="status">ëŒ€ê¸° ì¤‘</p>
  <button id="view" style="display:none" onclick="location.href='result.html'">í™•ì¸</button>

  <script>
    const startBtn = document.getElementById('start');
    const bar = document.getElementById('bar');
    const barInner = document.getElementById('barInner');
    const status = document.getElementById('status');
    const viewBtn = document.getElementById('view');

    // âœ… ì‹¤ì œ GitHub ì‚¬ìš©ìëª… / ì €ì¥ì†Œëª…ìœ¼ë¡œ êµì²´ë¨
    const OWNER = 'hyeokdo2004';
    const REPO = 'testpython';
    const WORKFLOW_FILENAME = 'crawl.yml'; // workflow file under .github/workflows

    startBtn.addEventListener('click', () => {
      // ğŸ‘‰ GitHub Actions workflow í˜ì´ì§€ë¥¼ ìƒˆ íƒ­ìœ¼ë¡œ ì—¼
      const url = `https://github.com/${OWNER}/${REPO}/actions/workflows/${WORKFLOW_FILENAME}`;
      window.open(url, '_blank');

      // ì§„í–‰ë¥  ë°” í‘œì‹œ ì‹œì‘
      bar.style.display = 'block';
      poll();
    });

    // ì§„í–‰ ìƒíƒœ(status.json)ë¥¼ ì£¼ê¸°ì ìœ¼ë¡œ í™•ì¸
    async function poll() {
      try {
        const res = await fetch('status.json?_=' + Date.now());
        if (!res.ok) throw 'no status';
        const st = await res.json();

        // ì§„í–‰ë¥  ë°” ì—…ë°ì´íŠ¸
        barInner.style.width = st.progress + '%';
        status.textContent = st.done
          ? 'âœ… ìˆ˜ì§‘ ì™„ë£Œ'
          : `ì§„í–‰ ì¤‘: ${st.current_board || ''} ${st.progress}%`;

        if (st.done) {
          viewBtn.style.display = 'inline-block';
        } else {
          setTimeout(poll, 2000);
        }
      } catch (e) {
        // status.jsonì´ ì•„ì§ ìƒì„±ë˜ì§€ ì•Šìœ¼ë©´ ì¬ì‹œë„
        status.textContent = 'ìƒíƒœ ëŒ€ê¸° ì¤‘... (Actions ì‹¤í–‰ í›„ ìë™ ê°±ì‹ )';
        setTimeout(poll, 4000);
      }
    }

    // í˜ì´ì§€ ì§„ì… ì‹œ ìƒíƒœ í™•ì¸
    poll();
  </script>
</body>
</html>
